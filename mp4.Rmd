---
title: "Mp4"
output: html_document
---

```{r}
library(mdsr)
library(RMySQL)
db <- dbConnect_scidb(dbname = "imdb")
```

```{r}
q <- "SELECT mi1.movie_id, 
			      mi1.info AS gross, 
            mi2.info, 
            t.title
      FROM title AS t
      JOIN movie_info AS mi1 ON
      	mi1.movie_id = t.id
      JOIN movie_info AS mi2 ON 
      	mi2.movie_id = mi1.movie_id
      WHERE mi1.info_type_id = 107
      		AND mi2.info_type_id = 8
      		AND mi2.info = 'USA'
          AND t.production_year BETWEEN 1960 AND 1969
      LIMIT 0, 100";
dbq <- dbGetQuery(db, q)

dbq %>%
  filter(grepl("USA|worldwide|Worldwide", gross)) %>%
  mutate(gross_string = str_extract(gross, "^\\$[0-9]+,[0-9]{3},[0-9]{3}"),
         gross = parse_number(gross_string)) %>%
  arrange(desc(gross))

```
